#!/bin/bash

# Nodes according to the official list: https://protonvpn.com/vpn-servers#secure-core
SERVERS=(
  "CH-AT#2"
  "SE-EE#1"
  "CH-EE#2"
  "CH-LU#2"
  "IS-NO#1"
  "SE-NO#1"
  "CH-NO#2"
  "SE-FI#1"
  "CH-FI#2"
  "SE-RO#1"
  "CH-RO#2"
)

case "$1" in
  "-l") # list
    printf "%s\n" "${SERVERS[@]}"
    ;;

  "-d") # disconnect
    echo "Disconnecting from ProtonVPN..."
    protonvpn disconnect
    ;;

  "-s") # status
    echo "--- VPN Status ---"
    protonvpn info | sed -E "s/\{'name': '([^']+)'\}/Account: \1/"
    echo "Public IP: $(curl -s https://ifconfig.me)"
    echo "------------------"
    ;;

  "-m") # menu
    PS3="Select a server number (or 'c' to cancel): "
    select s in "${SERVERS[@]}"; do
      if [[ "$REPLY" == "c" ]]; then
        echo "Connection attempt cancelled."
        exit 0
      elif [[ -n "$s" ]]; then
        echo "Connecting to $s..."
        protonvpn connect "$s"
        break
      else
        echo "Invalid option: $REPLY. Please choose a number from the list or 'c'."
      fi
    done
    ;;

  "-p") # privacy
    echo "Applying maximum privacy settings..."
    protonvpn config set ipv6 off
    protonvpn config set moderate-nat off
    protonvpn config set kill-switch standard
    protonvpn config set vpn-accelerator on
    protonvpn config set netshield malware-ads-trackers
    protonvpn config set custom-dns off
    echo "Privacy configuration applied."
    ;;

  "-h") # help
    echo "Usage: vpn [option]"
    echo "Options:"
    echo "  -d  Disconnect VPN"
    echo "  -l  List servers in the list"
    echo "  -s  Show connection status and IP"
    echo "  -m  Selection menu for specific servers"
    echo "  -p  Apply maximum privacy settings"
    echo "  -h  Show help information for commands"
    ;;

  *)
    INDEX=$(( RANDOM % ${#SERVERS[@]} ))
    SELECTED="${SERVERS[$INDEX]}"
    echo "Selected Secure Core Server: $SELECTED"
    protonvpn connect "$SELECTED"
    ;;
esac